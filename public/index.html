<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù†ØªÙŠØ¬ØªÙƒ</title>
<link rel="icon" href="https://i.postimg.cc/wjDmfHCB/logo.png" type="image/png">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap');
  
  :root {
    --primary: #3b82f6;
    --secondary: #10b981;
    --accent: #8b5cf6;
    --light: #f8fafc;
    --dark: #1e293b;
  }
  
  body {
    font-family: 'Tajawal', sans-serif;
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
    min-height: 100vh;
  }
  
  .card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
  }
  
  .card:hover {
    box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.15);
    transform: translateY(-5px);
  }
  
  .btn-primary {
    background: linear-gradient(to right, var(--primary), #2563eb);
    color: white;
    padding: 12px 24px;
    border-radius: 12px;
    font-weight: 700;
    transition: all 0.3s;
    box-shadow: 0 4px 6px rgba(37, 99, 235, 0.2);
  }
  
  .btn-primary:hover {
    background: linear-gradient(to right, #2563eb, #1d4ed8);
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(37, 99, 235, 0.3);
  }
  
  .btn-secondary {
    background: linear-gradient(to right, var(--secondary), #059669);
    color: white;
    padding: 12px 24px;
    border-radius: 12px;
    font-weight: 700;
    transition: all 0.3s;
    box-shadow: 0 4px 6px rgba(16, 185, 129, 0.2);
  }
  
  .btn-secondary:hover {
    background: linear-gradient(to right, #059669, #047857);
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(16, 185, 129, 0.3);
  }
  
  .btn-telegram {
    background: linear-gradient(to right, #0088cc, #2AABEE);
    color: white;
    padding: 12px 24px;
    border-radius: 12px;
    font-weight: 700;
    transition: all 0.3s;
    box-shadow: 0 4px 6px rgba(42, 171, 238, 0.2);
  }
  
  .btn-telegram:hover {
    background: linear-gradient(to right, #2AABEE, #229ED9);
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(42, 171, 238, 0.3);
  }
  
  /* Ø²Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
  .btn-app {
    background: linear-gradient(to right, #FF6B6B, #FF8E53);
    color: white;
    padding: 12px 24px;
    border-radius: 12px;
    font-weight: 700;
    transition: all 0.3s;
    box-shadow: 0 4px 6px rgba(255, 107, 107, 0.2);
  }
  
  .btn-app:hover {
    background: linear-gradient(to right, #FF8E53, #FF6B6B);
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(255, 107, 107, 0.3);
  }
  
  .alert-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 16px;
    margin-bottom: 24px;
  }
  
  @media (min-width: 768px) {
    .alert-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  
  .alert-box {
    padding: 16px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
  }
  
  .alert-danger {
    border-right: 4px solid #dc3545;
    background: linear-gradient(to left, #fff0f0, #fff);
  }
  
  .alert-success {
    border-right: 4px solid #10b981;
    background: linear-gradient(to left, #f0fdf4, #fff);
  }
  
  .alert-info {
    border-right: 4px solid #3b82f6;
    background: linear-gradient(to left, #f0f9ff, #fff);
  }
  
  .alert-purple {
    border-right: 4px solid #8b5cf6;
    background: linear-gradient(to left, #f5f3ff, #fff);
  }
  
  .alert-icon {
    font-size: 1.8rem;
    margin-left: 12px;
    flex-shrink: 0;
  }
  
  .alert-danger .alert-icon { color: #dc3545; }
  .alert-success .alert-icon { color: #10b981; }
  .alert-info .alert-icon { color: #3b82f6; }
  .alert-purple .alert-icon { color: #8b5cf6; }
  
  table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    margin: 20px 0;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
  }
  
  th {
    background: linear-gradient(to right, var(--primary), #2563eb);
    color: white;
    padding: 12px;
    font-weight: 600;
  }
  
  td {
    padding: 12px;
    border-bottom: 1px solid #e5e7eb;
    text-align: center;
  }
  
  tr:last-child td {
    border-bottom: none;
  }
  
  tr:nth-child(even) {
    background-color: #f9fafb;
  }
  
  input, .file-input {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid #e5e7eb;
    border-radius: 12px;
    transition: all 0.3s;
    background: #f9fafb;
  }
  
  input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
    background: white;
  }
  
  .file-input {
    padding: 8px;
  }
  
  .header-icon {
    font-size: 3rem;
    background: linear-gradient(to right, var(--primary), var(--accent));
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 10px;
  }
  
  .step-number {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 30px;
    height: 30px;
    background: var(--primary);
    color: white;
    border-radius: 50%;
    margin-left: 8px;
  }
  
  .feature-icon {
    font-size: 1.5rem;
    color: var(--primary);
    margin-left: 10px;
  }
  
  .footer {
    background: var(--dark);
    color: white;
    padding: 20px;
    margin-top: 40px;
    border-radius: 16px 16px 0 0;
  }
  
  @media (max-width: 768px) {
    .container {
      padding: 16px;
    }
    
    .btn-primary, .btn-secondary, .btn-telegram, .btn-app {
      width: 100%;
      margin-bottom: 10px;
    }
  }

  /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
  @media print {
    body * {
      visibility: hidden;
    }
    #printableResult, #printableResult * {
      visibility: visible;
    }
    #printableResult {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      padding: 20px;
      background: white;
    }
    .no-print {
      display: none !important;
    }
    .card {
      box-shadow: none;
      border: 1px solid #ddd;
      page-break-inside: avoid;
    }
    table {
      page-break-inside: avoid;
    }
    h2, h3 {
      page-break-after: avoid;
    }
  }

  /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© */
  .result-header {
    text-align: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid var(--primary);
  }

  .result-section {
    margin-bottom: 25px;
    page-break-inside: avoid;
  }

  .result-table {
    width: 100%;
    border-collapse: collapse;
    margin: 10px 0;
  }

  .result-table th, .result-table td {
    border: 1px solid #ddd;
    padding: 10px;
    text-align: center;
  }

  .result-table th {
    background-color: #f2f2f2;
  }

  .summary-box {
    background-color: #f9fafb;
    padding: 15px;
    border-radius: 10px;
    margin: 20px 0;
  }

  /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
  .print-window {
    display: none;
    position: fixed;
    z-index: 100;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.4);
  }

  .print-content {
    background-color: #fefefe;
    margin: 5% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
    max-width: 800px;
    border-radius: 10px;
  }

  .close {
    color: #aaa;
    float: left;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
  }

  .close:hover,
  .close:focus {
    color: black;
    text-decoration: none;
  }

  .spinner {
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  #pdf-container {
    position: absolute;
    left: -9999px;
    top: -9999px;
  }

  /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© */
  #chatbot input {
    font-family: 'Tajawal', sans-serif;
    direction: rtl;
  }

  #chatbot input::placeholder {
    text-align: right;
  }

  #chatbot button {
    font-family: 'Tajawal', sans-serif;
    font-weight: 500;
  }
</style>
</head>
<body class="flex flex-col items-center justify-start min-h-screen p-4">

<div class="container max-w-4xl mx-auto">
  <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
  <header class="text-center my-8">
    <i class="fas fa-graduation-cap header-icon"></i>
    <h1 class="text-4xl font-bold mb-2 text-gray-800">Ù†ØªÙŠØ¬ØªÙƒ</h1>
    <p class="text-lg text-gray-600">Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</p>
    <p class="text-lg text-gray-600">Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØªØ§Ù†ÙŠØ© Ø«Ø§Ù†ÙˆÙŠ ÙÙ‚Ø· Ø¨Ù…Ø­Ø§ÙØ¸Ø© Ø§Ù„Ø¬ÙŠØ²Ø©</p>
    <h1>Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡ Ø§Ù„Ø§Ù† Ø¨Ø±Ø¬Ø§Ø¡ Ø¹Ø¯Ù… Ø§Ù„Ø¯ÙØ¹</h1>
  </header>

  <!-- Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø¹Ù„Ù‰ Ø´ÙƒÙ„ Ø´Ø¨ÙƒØ© -->
  <div class="alert-grid">
    <div class="alert-box alert-danger">
      <i class="fas fa-exclamation-triangle alert-icon"></i>
      <div>
        <p class="font-bold text-red-600">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù…Ø¸Ù‡Ø±ØªØ´</p>
        <p class="text-green-700 font-medium">"Ø¥ÙÙ„Ù‡Ù Ø§Ù„Ø³Ù‘ÙÙ„Ø§ÙÙ…Ù Ù…ÙØ¹ÙÙƒÙÙ…Ù’ Ø£ÙØ¬Ù’Ù…ÙØ¹ÙÙŠÙ†Ù. Ø¢Ù…ÙÙŠÙ†Ù." (Ø±Ùˆ 15: 33).</p>
      </div>
    </div>

    <div class="alert-box alert-info">
      <i class="fas fa-ban alert-icon"></i>
      <p class="text-blue-800 font-bold">Ù…Ù…Ù†ÙˆØ¹ Ù…Ù†Ø¹Ø§Ù‹ Ø¨Ø§ØªØ§Ù‹ ØªÙØªØ­ Ø£ÙŠ Ø­Ø§Ø¬Ø© Ø£Ùˆ ØªØ­Ø§ÙˆÙ„ ØªØ¬ÙŠØ¨ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù…Ù† Ù…ÙƒØ§Ù† ØªØ§Ù†ÙŠ Ø¹Ù„Ø´Ø§Ù† Ù‡ÙŠØ­ØµÙ„ Ù…Ø´ÙƒÙ„Ø© ÙˆØ£Ù†Ø§ Ù…Ø´ Ù…Ø³Ø¤ÙˆÙ„</p>
    </div>

    <div class="alert-box alert-success">
      <i class="fas fa-info-circle alert-icon"></i>
      <p class="text-gray-800">Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± ØªØ§Ø¨Ø¹ Ù„Ø£ÙŠ Ø¬Ù‡Ø© Ø­ÙƒÙˆÙ…ÙŠØ© Ø£Ùˆ ÙˆØ²Ø§Ø±Ø©ØŒ ÙˆØ¥Ù†Ù…Ø§ Ù‡Ùˆ Ù…Ø¨Ø§Ø¯Ø±Ø© Ø´Ø®ØµÙŠØ© Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙÙ‚Ø·. Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø³Ø±ÙŠØ© ØªØ§Ù…Ø© Ø«Ù… ØªØªØ­Ø°Ù Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªÙŠØ¬Ø©</p>
    </div>

    <div class="alert-box alert-purple">
      <i class="fas fa-envelope alert-icon"></i>
      <p class="text-purple-800 font-bold">"Ø³ØªØ¸Ù‡Ø± Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© ÙˆØ³ÙŠØªÙ… Ø£ÙŠØ¶Ù‹Ø§ Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ø¥Ù„Ù‰ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø®Ù„Ø§Ù„ Ø¯Ù‚ÙŠÙ‚ØªÙŠÙ† ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§."</p>
    </div>
  </div>

  <!-- Ø£Ø²Ø±Ø§Ø± Ø­Ø¬Ø² Ø§Ù„Ù†ØªÙŠØ¬Ø© -->
  <div class="card p-6 mb-6">
    <h2 class="text-2xl font-semibold mb-4 text-gray-800 text-center">
      <i class="fas fa-ticket-alt"></i>
      Ø­Ø¬Ø² Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹
    </h2>
    <h2>Ø¨Ø±Ø¬Ø§Ø¡ Ù„Ù„Ø­Ø¬Ø² Ø¯ÙØ¹ Ø§Ù„Ù…Ø¨Ù„Øº 25 Ø¬Ù†ÙŠÙ‡Ø§Ù‹ Ø§Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù… Ù‡Ø°Ø§</h2>
    <h1>01274445091</h1>
    <div class="flex flex-col sm:flex-row gap-4 justify-center">
      <a href="https://t.me/gizaresult_bot" target="_blank" class="btn-telegram text-center">
        <i class="fab fa-telegram-plane"></i>
        Ø­Ø¬Ø² Ø¹Ø¨Ø± Ø§Ù„ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
      </a>
      
<!-- Ø²Ø± Ø­Ø¬Ø² Ø¹Ø¨Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
<button onclick="window.location.href='https://apkpure.com/gizaresult/com.example.giza_result_app'" class="btn-app text-center">
  <i class="fas fa-mobile-alt"></i>
  Ø­Ø¬Ø² Ø¹Ø¨Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
</button>

      
      <button onclick="showReservation()" class="btn-secondary">
        <i class="fas fa-globe"></i>
        Ø­Ø¬Ø² Ø¹Ø¨Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹
      </button>
    </div>
  </div>

<!-- Ù‚Ø³Ù… Ø­Ø¬Ø² Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¹Ø¨Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹ -->
<div class="card p-6 mb-6 hidden" id="reservation">
  <h2 class="text-2xl font-semibold mb-4 text-gray-800">
    <i class="fas fa-globe"></i>
    Ø­Ø¬Ø² Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¹Ø¨Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹
  </h2>
  
  <form id="reservationForm" class="space-y-4">
    <div>
      <label class="block text-gray-700 mb-2">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ</label>
      <input name="nationalId" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ" required class="w-full p-3 border rounded-lg">
    </div>
    
    <div>
      <label class="block text-gray-700 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
      <input name="phone" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" required class="w-full p-3 border rounded-lg">
    </div>
    
    <div>
      <label class="block text-gray-700 mb-2">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
      <input name="email" type="email" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required class="w-full p-3 border rounded-lg">
    </div>
    
    <!-- Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© -->
    <div>
      <label class="block text-gray-700 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙˆÙ„ (Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø°ÙŠ ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù…Ù†Ù‡)</label>
      <input name="senderPhone" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø­ÙˆÙ„ Ù…Ù†Ù‡" required class="w-full p-3 border rounded-lg">
    </div>
    
    <div>
      <label class="block text-gray-700 mb-2">Ø³ÙƒØ±ÙŠÙ† Ø´ÙˆØª Ø§Ù„ØªØ­ÙˆÙŠÙ„</label>
      <input type="file" name="screenshot" required class="file-input">
    </div>
    <!-- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© -->
    
    <button type="submit" class="btn-primary w-full py-3">
      <i class="fas fa-check-circle"></i>
      ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²
    </button>
  </form>
</div>

  <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
  <div class="flex flex-col sm:flex-row gap-4 justify-center mb-8">
    <button onclick="showPayment()" class="btn-primary">
      <i class="fas fa-money-bill-wave"></i>
      Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹ Ù„Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø§Ù„Ù†ØªÙŠØ¬Ø©
    </button>
    <button onclick="showCheck()" class="btn-secondary">
      <i class="fas fa-search"></i>
      Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¯ÙØ¹
    </button>
  </div>

  <!-- Ù‚Ø³Ù… Ø§Ù„Ø¯ÙØ¹ -->
  <div class="card p-6 mb-6 hidden" id="payment">
    <h2 class="text-2xl font-semibold mb-4 text-gray-800">
      <i class="fas fa-credit-card"></i>
      Ø§Ù„Ø¯ÙØ¹ Ø¹Ù† Ø·Ø±ÙŠÙ‚ ØªØ­ÙˆÙŠÙ„ Ù…Ø­ÙØ¸Ø©
    </h2>
    
    <h1>Ø¨Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ø«Ù… Ø§Ù†ØªØ¸Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØµÙØ­</h1>

    <div class="bg-blue-50 p-4 rounded-lg mb-4">
      <p class="text-blue-800 font-bold text-center">
        Ù‚Ù… Ø¨Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù…: 
        <span class="text-xl">01274445091</span>
      </p>
    </div>
    
    <form id="paymentForm" class="space-y-4">
      <div>
        <label class="block text-gray-700 mb-2">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ</label>
        <input name="nationalId" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ" required class="w-full p-3 border rounded-lg">
      </div>
      
      <div>
        <label class="block text-gray-700 mb-2">Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³</label>
        <input name="seatNumber" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³" required class="w-full p-3 border rounded-lg">
      </div>
      
      <div>
        <label class="block text-gray-700 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
        <input name="phone" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" required class="w-full p-3 border rounded-lg">
      </div>
      
      <div>
        <label class="block text-gray-700 mb-2">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
        <input name="email" type="email" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required class="w-full p-3 border rounded-lg">
      </div>
      
      <div>
        <label class="block text-gray-700 mb-2">ØµÙˆØ±Ø© Ø¥Ø«Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„</label>
        <input type="file" name="screenshot" required class="file-input">
      </div>
      
      <button type="submit" class="btn-primary w-full py-3">
        <i class="fas fa-check-circle"></i>
        ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª(Ø¨Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ø«Ù… Ø§Ù†ØªØ¸Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØµÙØ­)
      </button>
    </form>
  </div>

  <!-- Ù‚Ø³Ù… Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… -->
  <div class="card p-6 mb-6 hidden" id="check">
    <h2 class="text-2xl font-semibold mb-4 text-gray-800">
      <i class="fas fa-search"></i>
      Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø§Ù„Ù†ØªÙŠØ¬Ø©
    </h2>
    
    <form id="checkForm" class="space-y-4">
      <div>
        <label class="block text-gray-700 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø³Ø¬Ù„</label>
        <input name="phone" id="phoneInput" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ø°ÙŠ Ø§Ø³ØªØ®Ø¯Ù…ØªÙ‡ ÙÙŠ Ø§Ù„Ø¯ÙØ¹" required class="w-full p-3 border rounded-lg">
      </div>
      
      <button type="submit" class="btn-secondary w-full py-3">
        <i class="fas fa-download"></i>
        Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø§Ù„Ù†ØªÙŠØ¬Ø©
      </button>
    </form>

    <!-- Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… -->
    <div id="resultContainer" class="mt-6 hidden">
      <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-4 rounded-lg text-center mb-6">
        <h3 class="text-xl font-bold">ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ù‡Ø°Ù‡ Ù‡ÙŠ Ù†ØªÙŠØ¬ØªÙƒ</h3>
      </div>
      
      <!-- Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© -->
      <div id="printableResult">
        <div class="result-header">
          <h2>Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø·Ø§Ù„Ø¨</h2>
          <p>Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª - Ù…Ø­Ø§ÙØ¸Ø© Ø§Ù„Ø¬ÙŠØ²Ø©</p>
          <p>Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ - Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ 2025/2026</p>
        </div>
        
        <div class="card p-4 mb-6">
          <h3 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2">
            <i class="fas fa-user-graduate"></i>
            Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="studentInfo"></div>
        </div>

        <div class="card p-4 mb-6">
          <h3 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2">
            <i class="fas fa-book"></i>
            Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
          </h3>
          <table id="mainSubjectsTable">
            <thead>
              <tr>
                <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                <th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                <th>Ù…Ù†</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="card p-4 mb-6">
          <h3 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2">
            <i class="fas fa-book-open"></i>
            Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
          </h3>
          <table id="additionalSubjectsTable">
            <thead>
              <tr>
                <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                <th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                <th>Ù…Ù†</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="card p-4">
          <h3 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2">
            <i class="fas fa-chart-pie"></i>
            Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙˆØ§Ù„Ù†Ø³Ø¨Ø©
          </h3>
          <table>
            <tr>
              <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ</th>
              <td id="totalScore" class="font-bold"></td>
            </tr>
            <tr>
              <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ Ø§Ù„Ù…Ù…ÙƒÙ†</th>
              <td id="totalOutOf"></td>
            </tr>
            <tr>
              <th>Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©</th>
              <td id="percentage" class="font-bold text-green-600"></td>
            </tr>
          </table>
        </div>
          <button onclick="saveAsPDF()" class="btn-secondary ml-4">
            <i class="fas fa-file-pdf"></i>
            Ø­ÙØ¸ ÙƒPDF
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 my-8">
    <div class="card p-4 text-center">
      <i class="fas fa-lock feature-icon"></i>
      <h3 class="font-bold mb-2">Ø¨ÙŠØ§Ù†Ø§Øª Ø¢Ù…Ù†Ø©</h3>
      <p class="text-gray-600">Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù…Ø­Ù…ÙŠØ© ÙˆÙ„Ø§ ÙŠØªÙ… Ù…Ø´Ø§Ø±ÙƒØªÙ‡Ø§ Ù…Ø¹ Ø£ÙŠ Ø·Ø±Ù Ø«Ø§Ù„Ø«</p>
    </div>
    
    <div class="card p-4 text-center">
      <i class="fas fa-bolt feature-icon"></i>
      <h3 class="font-bold mb-2">Ù†ØªØ§Ø¦Ø¬ Ø³Ø±ÙŠØ¹Ø©</h3>
      <p class="text-gray-600">Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬ØªÙƒ ÙÙŠ Ø®Ù„Ø§Ù„ Ø¯Ù‚Ø§Ø¦Ù‚ Ù…Ù† Ø§Ù„ØªØ­ÙˆÙŠÙ„</p>
    </div>
    
    <div class="card p-4 text-center">
      <i class="fas fa-headset feature-icon"></i>
      <h3 class="font-bold mb-2">Ø¯Ø¹Ù… ÙÙ†ÙŠ</h3>
      <p class="text-gray-600">ÙØ±ÙŠÙ‚ Ø§Ù„Ø¯Ø¹Ù… Ù…ØªØ§Ø­ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ Ø£ÙŠ Ø§Ø³ØªÙØ³Ø§Ø±</p>
    </div>
  </div>

  <!-- Ø§Ù„ÙÙˆØªØ± -->
  <div class="footer text-center rounded-lg">
    <p>Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± ØªØ§Ø¨Ø¹ Ù„Ø£ÙŠ Ø¬Ù‡Ø© Ø­ÙƒÙˆÙ…ÙŠØ© Ø£Ùˆ ÙˆØ²Ø§Ø±Ø©</p>
    <p class="mt-2">
      ØªÙ… Ø§Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨ÙˆØ§Ø³Ø·Ø© 
      <a href="https://wa.me/201274445091" class="text-purple-500 font-semibold hover:text-purple-700">
        John Latif
      </a>
    </p>
  </div>
</div>
<!-- Ø²Ø± ÙØªØ­/ØºÙ„Ù‚ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© -->
<div id="chatbotToggle" style="position: fixed; bottom: 20px; right: 20px; z-index: 1000;">
  <button onclick="toggleChatbot()" style="background:#3b82f6; color:white; border:none; padding:12px 20px; border-radius:50px; cursor:pointer; font-weight:bold;">
    ğŸ’¬ Ø§Ù„Ø¯Ø¹Ù…
  </button>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© -->
<div id="chatbot" style="position: fixed; bottom: 80px; right: 20px; width: 320px; max-height: 400px; background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); display:none; flex-direction: column; overflow:hidden; z-index: 1000; font-family: 'Tajawal', sans-serif;">
  <div style="background:#3b82f6; color:white; padding:10px; font-weight:bold; text-align:center; cursor:pointer;" onclick="toggleChatbot()">
    Ø¯Ø¹Ù… ÙÙ†ÙŠ - Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø£ÙˆÙ„Ø§Ù‹
  </div>
  <div id="chatMessages" style="flex:1; padding:10px; overflow-y:auto;"></div>
  <div id="chatOptions" style="padding:10px; display:none; flex-direction:column; gap:8px;">
    <button class="chatOption" data-action="whatsapp" style="padding:8px; border-radius:8px; border:none; background:#10b981; color:white; cursor:pointer;">Ø­ÙˆÙ„ Ø¹Ù„Ù‰ ÙˆØ§ØªØ³</button>
    <button class="chatOption" data-action="ask" style="padding:8px; border-radius:8px; border:none; background:#8b5cf6; color:white; cursor:pointer;">Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø´ÙŠØ¡</button>
  </div>
  
  <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
  <div id="userDataForm" style="padding:10px; display:flex; flex-direction:column; gap:8px;">
    <input type="text" id="userName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„" style="padding:8px; border-radius:8px; border:1px solid #ddd;">
    <input type="tel" id="userPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙŠÙÙˆÙ†" style="padding:8px; border-radius:8px; border:1px solid #ddd;">
    <input type="email" id="userEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" style="padding:8px; border-radius:8px; border:1px solid #ddd;">
    <button id="submitUserData" style="padding:8px; border-radius:8px; border:none; background:#3b82f6; color:white; cursor:pointer;">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
  </div>
</div>
<!-- Ø­Ø§ÙˆÙŠØ© Ù…Ø®ÙÙŠØ© Ù„Ø¥Ù†Ø´Ø§Ø¡ PDF -->
<div id="pdf-container" style="position: absolute; left: -9999px; top: -9999px;"></div>

<script>
// Ù…ØªØºÙŠØ± Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
let currentResult = null;

// Ù…ØªØºÙŠØ±Ø§Øª Ù„ØªØ®Ø²ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
let userData = {
  name: '',
  phone: '',
  email: ''
};

function showPayment() {
  document.getElementById('payment').classList.remove('hidden');
  document.getElementById('check').classList.add('hidden');
  document.getElementById('reservation').classList.add('hidden');
}

function showCheck() {
  document.getElementById('check').classList.remove('hidden');
  document.getElementById('payment').classList.add('hidden');
  document.getElementById('reservation').classList.add('hidden');
}

function showReservation() {
  document.getElementById('reservation').classList.remove('hidden');
  document.getElementById('payment').classList.add('hidden');
  document.getElementById('check').classList.add('hidden');
}

// Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ù†ØªÙŠØ¬Ø©
document.getElementById('checkForm').addEventListener('submit', async e => {
  e.preventDefault();
  const phone = document.getElementById('phoneInput').value;

  // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„
  const submitBtn = e.target.querySelector('button[type="submit"]');
  const originalText = submitBtn.innerHTML;
  submitBtn.innerHTML = '<i class="fas fa-spinner spinner"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...';
  submitBtn.disabled = true;

  try {
    const res = await fetch('/api/check-result', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({phone})
    });

    const data = await res.json();
    
    if (!res.ok || !data.success) {
      throw new Error(data.message || 'ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù†ØªÙŠØ¬Ø©');
    }

    currentResult = data.result;
    displayResult(data.result);
    
  } catch (error) {
    alert(error.message || 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ø£Ùˆ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¯ÙØ¹ Ø¨Ø¹Ø¯');
    console.error('Error:', error);
  } finally {
    submitBtn.innerHTML = originalText;
    submitBtn.disabled = false;
  }
});
// Ù…Ø¹Ø§Ù„Ø¬Ø© Ø­Ø¬Ø² Ø§Ù„Ù†ØªÙŠØ¬Ø©
document.getElementById('reservationForm').addEventListener('submit', async e => {
  e.preventDefault();
  
  const formData = new FormData(e.target);
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„Ù
  if (!formData.get('screenshot') || formData.get('screenshot').size === 0) {
    alert('ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¥Ø«Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„');
    return;
  }

  const submitBtn = e.target.querySelector('button[type="submit"]');
  const originalText = submitBtn.innerHTML;
  submitBtn.innerHTML = '<i class="fas fa-spinner spinner"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø¬Ø²...';
  submitBtn.disabled = true;

  try {
    const res = await fetch('/reserve', {
      method: 'POST',
      body: formData
    });

    if (res.ok) {
      alert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­ØŒ ÙˆØ³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ù‹Ø§.');
      e.target.reset();
      document.getElementById('reservation').classList.add('hidden');
    } else {
      const errorText = await res.text();
      throw new Error(errorText || 'ÙØ´Ù„ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²');
    }
  } catch (error) {
    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø­Ø¬Ø²: ' + error.message);
    console.error('Error:', error);
  } finally {
    submitBtn.innerHTML = originalText;
    submitBtn.disabled = false;
  }
});

// Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¯ÙØ¹ Ø§Ù„Ù†ØªÙŠØ¬Ø©
document.getElementById('paymentForm').addEventListener('submit', async e => {
  e.preventDefault();
  const formData = new FormData(e.target);
  
  const submitBtn = e.target.querySelector('button[type="submit"]');
  const originalText = submitBtn.innerHTML;
  submitBtn.innerHTML = '<i class="fas fa-spinner spinner"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
  submitBtn.disabled = true;

  try {
    const res = await fetch('/pay', {
      method: 'POST',
      body: formData
    });

    if (res.ok) {
      alert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø·Ù„Ø¨ÙƒØŒ Ø³ÙŠØªÙ… Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¯ÙØ¹ Ù‚Ø±ÙŠØ¨Ù‹Ø§.');
      e.target.reset();
      document.getElementById('payment').classList.add('hidden');
    } else {
      throw new Error('ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
    }
  } catch (error) {
    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message);
    console.error('Error:', error);
  } finally {
    submitBtn.innerHTML = originalText;
    submitBtn.disabled = false;
  }
});

// Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…Ø­Ø³Ù†
function displayResult(result) {
  if (!result || typeof result !== 'object') {
    alert('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†ØªÙŠØ¬Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
    return;
  }

  console.log('Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©:', result); // Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„ØªØµØ­ÙŠØ­

  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨
  const infoDiv = document.getElementById('studentInfo');
  infoDiv.innerHTML = '';
  
  // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
  const fieldsToShow = [
    { key: 'name', label: 'Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨' },
    { key: 'seatNumber', label: 'Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³' },
    { key: 'stage', label: 'Ø§Ù„Ù…Ø±Ø­Ù„Ø©' },
    { key: 'gradeLevel', label: 'Ø§Ù„ØµÙ' },
    { key: 'division', label: 'Ø§Ù„Ø´Ø¹Ø¨Ø©' },
    { key: 'schoolName', label: 'Ø§Ù„Ù…Ø¯Ø±Ø³Ø©' },
    { key: 'notes', label: 'Ù…Ù„Ø§Ø­Ø¸Ø§Øª' }
  ];
  
  fieldsToShow.forEach(field => {
    if (result[field.key] !== undefined && result[field.key] !== null && result[field.key] !== '') {
      const div = document.createElement('div');
      div.innerHTML = `<strong>${field.label}:</strong> ${result[field.key]}`;
      infoDiv.appendChild(div);
    }
  });

  // Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
  const mainTbody = document.querySelector('#mainSubjectsTable tbody');
  mainTbody.innerHTML = '';
  
  if (result.mainSubjects && Array.isArray(result.mainSubjects) && result.mainSubjects.length > 0) {
    result.mainSubjects.forEach(sub => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${sub.name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td>
        <td>${sub.score || '0'}</td>
        <td>${sub.outOf || '0'}</td>
      `;
      mainTbody.appendChild(tr);
    });
  } else {
    mainTbody.innerHTML = '<tr><td colspan="3">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>';
  }

  // Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
  const addTbody = document.querySelector('#additionalSubjectsTable tbody');
  addTbody.innerHTML = '';
  
  if (result.additionalSubjects && Array.isArray(result.additionalSubjects) && result.additionalSubjects.length > 0) {
    result.additionalSubjects.forEach(sub => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${sub.name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td>
        <td>${sub.score || '0'}</td>
        <td>${sub.outOf || '0'}</td>
      `;
      addTbody.appendChild(tr);
    });
  } else {
    addTbody.innerHTML = '<tr><td colspan="3">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>';
  }

  // Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙˆØ§Ù„Ù†Ø³Ø¨Ø©
  const totalScore = result.totalScore || 0;
  const totalOutOf = result.totalOutOf || 0;
  let percentage = result.percentage;
  
  if (!percentage && totalOutOf > 0) {
    percentage = Math.round((totalScore / totalOutOf) * 100);
  }
  
  document.getElementById('totalScore').textContent = totalScore;
  document.getElementById('totalOutOf').textContent = totalOutOf;
  document.getElementById('percentage').textContent = (percentage || 0) + '%';

  document.getElementById('resultContainer').classList.remove('hidden');
  currentResult = result;
}

// Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø©
function printResult() {
  if (!currentResult) {
    alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªÙŠØ¬Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©');
    return;
  }

  // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø§ÙØ°Ø© Ø·Ø¨Ø§Ø¹Ø© Ø¬Ø¯ÙŠØ¯Ø©
  const printWindow = window.open('', '_blank');
  
  // Ù…Ø­ØªÙˆÙ‰ HTML Ù…Ø®ØµØµ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©
  printWindow.document.write(`
    <!DOCTYPE html>
    <html lang="ar" dir="rtl">
    <head>
      <meta charset="UTF-8">
      <title>Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ - ${currentResult.name || ''}</title>
      <style>
        body {
          font-family: 'Tajawal', sans-serif;
          padding: 20px;
          color: #000;
          background: white;
          line-height: 1.6;
        }
        .card {
          background: white;
          border-radius: 8px;
          border: 1px solid #ddd;
          padding: 15px;
          margin-bottom: 15px;
        }
        table {
          width: 100%;
          border-collapse: collapse;
          margin: 10px 0;
        }
        th, td {
          border: 1px solid #ddd;
          padding: 8px;
          text-align: center;
        }
        th {
          background-color: #f2f2f2;
          font-weight: bold;
        }
        .result-header {
          text-align: center;
          margin-bottom: 20px;
          padding-bottom: 15px;
          border-bottom: 2px solid #3b82f6;
        }
        .summary-box {
          background-color: #f9fafb;
          padding: 15px;
          border-radius: 8px;
          margin: 15px 0;
        }
        .no-print {
          display: none !important;
        }
        @media print {
          body {
            padding: 0;
            margin: 0;
          }
          .card {
            page-break-inside: avoid;
          }
          table {
            page-break-inside: avoid;
          }
        }
      </style>
    </head>
    <body>
      <div class="result-header">
        <h2>Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø·Ø§Ù„Ø¨</h2>
        <p>Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª - Ù…Ø­Ø§ÙØ¸Ø© Ø§Ù„Ø¬ÙŠØ²Ø©</p>
        <p>Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ - Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ 2025/2026</p>
      </div>
      
      <div class="card">
        <h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</h3>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
          <div><strong>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</strong> ${currentResult.name || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</div>
          <div><strong>Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³:</strong> ${currentResult.seatNumber || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</div>
          <div><strong>Ø§Ù„Ù…Ø±Ø­Ù„Ø©:</strong> ${currentResult.stage || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</div>
          <div><strong>Ø§Ù„Ø´Ø¹Ø¨Ø©:</strong> ${currentResult.division || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</div>
          <div><strong>Ø§Ù„ØµÙ:</strong> ${currentResult.gradeLevel || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</div>
          <div><strong>Ø§Ù„Ù…Ø¯Ø±Ø³Ø©:</strong> ${currentResult.schoolName || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</div>
          <div><strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> ${currentResult.notes || 'Ù„Ø§ ØªÙˆØ¬Ø¯'}</div>
        </div>
      </div>

      <div class="card">
        <h3>Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h3>
        <table>
          <thead>
            <tr>
              <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
              <th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
              <th>Ù…Ù†</th>
            </tr>
          </thead>
          <tbody>
            ${currentResult.mainSubjects ? currentResult.mainSubjects.map(sub => 
              `<tr><td>${sub.name}</td><td>${sub.score}</td><td>${sub.outOf}</td></tr>`
            ).join('') : '<tr><td colspan="3">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>'}
          </tbody>
        </table>
      </div>

      <div class="card">
        <h3>Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©</h3>
        <table>
          <thead>
            <tr>
              <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
              <th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
              <th>Ù…Ù†</th>
            </tr>
          </thead>
          <tbody>
            ${currentResult.additionalSubjects ? currentResult.additionalSubjects.map(sub => 
              `<tr><td>${sub.name}</td><td>${sub.score}</td><td>${sub.outOf}</td></tr>`
            ).join('') : '<tr><td colspan="3">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>'}
          </tbody>
        </table>
      </div>

      <div class="card">
        <h3>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙˆØ§Ù„Ù†Ø³Ø¨Ø©</h3>
        <table>
          <tr>
            <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ</th>
            <td>${currentResult.totalScore || '0'}</td>
          </tr>
          <tr>
            <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ Ø§Ù„Ù…Ù…ÙƒÙ†</th>
            <td>${currentResult.totalOutOf || '0'}</td>
          </tr>
          <tr>
            <th>Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©</th>
            <td>${currentResult.percentage || '0'}%</td>
          </tr>
        </table>
      </div>
      
      <div class="no-print" style="text-align: center; margin-top: 20px;">
        <button onclick="window.print()" style="background: #3b82f6; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">
          Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø©
        </button>
      </div>
    </body>
    </html>
  `);
  
  printWindow.document.close();
  
  // Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø«Ù… Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø§ÙØ°Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©
  setTimeout(() => {
    printWindow.focus();
  }, 500);
}

// Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙƒPDF
async function saveAsPDF() {
  if (!currentResult) {
    alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªÙŠØ¬Ø© Ù„Ø­ÙØ¸Ù‡Ø§');
    return;
  }

  try {
    // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ù…Ø¤Ù‚Øª Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©
    const printableElement = document.createElement('div');
    printableElement.style.padding = '20px';
    printableElement.style.fontFamily = "'Tajawal', sans-serif";
    printableElement.style.direction = 'rtl';
    
    printableElement.innerHTML = `
      <div style="text-align: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #3b82f6;">
        <h2>Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø·Ø§Ù„Ø¨</h2>
        <p>Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª - Ù…Ø­Ø§ÙØ¸Ø© Ø§Ù„Ø¬ÙŠØ²Ø©</p>
        <p>Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ - Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ 2023/2024</p>
      </div>
      
      <div style="background: white; border-radius: 8px; border: 1px solid #ddd; padding: 15px; margin-bottom: 15px;">
        <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; border-bottom: 1px solid #ddd; padding-bottom: 0.5rem;">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</h3>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
          <div><strong>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</strong> ${currentResult.name || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</div>
          <div><strong>Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³:</strong> ${currentResult.seatNumber || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</div>
          <div><strong>Ø§Ù„Ù…Ø±Ø­Ù„Ø©:</strong> ${currentResult.stage || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</div>
          <div><strong>Ø§Ù„Ø´Ø¹Ø¨Ø©:</strong> ${currentResult.division || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</div>
          <div><strong>Ø§Ù„ØµÙ:</strong> ${currentResult.gradeLevel || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</div>
          <div><strong>Ø§Ù„Ù…Ø¯Ø±Ø³Ø©:</strong> ${currentResult.schoolName || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</div>
          <div><strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> ${currentResult.notes || 'Ù„Ø§ ØªÙˆØ¬Ø¯'}</div>
        </div>
      </div>

      <div style="background: white; border-radius: 8px; border: 1px solid #ddd; padding: 15px; margin-bottom: 15px;">
        <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; border-bottom: 1px solid #ddd; padding-bottom: 0.5rem;">Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h3>
        <table style="width: 100%; border-collapse: collapse; margin: 10px 0;">
          <thead>
            <tr>
              <th style="border: 1px solid #ddd; padding: 8px; text-align: center; background-color: #f2f2f2; font-weight: bold;">Ø§Ù„Ù…Ø§Ø¯Ø©</th>
              <th style="border: 1px solid #ddd; padding: 8px; text-align: center; background-color: #f2f2f2; font-weight: bold;">Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
              <th style="border: 1px solid #ddd; padding: 8px; text-align: center; background-color: #f2f2f2; font-weight: bold;">Ù…Ù†</th>
            </tr>
          </thead>
          <tbody>
            ${currentResult.mainSubjects ? currentResult.mainSubjects.map(sub => 
              `<tr>
                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${sub.name}</td>
                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${sub.score}</td>
                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${sub.outOf}</td>
              </tr>`
            ).join('') : '<tr><td colspan="3" style="border: 1px solid #ddd; padding: 8px; text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>'}
          </tbody>
        </table>
      </div>

      <div style="background: white; border-radius: 8px; border: 1px solid #ddd; padding: 15px; margin-bottom: 15px;">
        <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; border-bottom: 1px solid #ddd; padding-bottom: 0.5rem;">Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©</h3>
        <table style="width: 100%; border-collapse: collapse; margin: 10px 0;">
          <thead>
            <tr>
              <th style="border: 1px solid #ddd; padding: 8px; text-align: center; background-color: #f2f2f2; font-weight: bold;">Ø§Ù„Ù…Ø§Ø¯Ø©</th>
              <th style="border: 1px solid #ddd; padding: 8px; text-align: center; background-color: #f2f2f2; font-weight: bold;">Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
              <th style="border: 1px solid #ddd; padding: 8px; text-align: center; background-color: #f2f2f2; font-weight: bold;">Ù…Ù†</th>
            </tr>
          </thead>
          <tbody>
            ${currentResult.additionalSubjects ? currentResult.additionalSubjects.map(sub => 
              `<tr>
                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${sub.name}</td>
                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${sub.score}</td>
                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${sub.outOf}</td>
              </tr>`
            ).join('') : '<tr><td colspan="3" style="border: 1px solid #ddd; padding: 8px; text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>'}
          </tbody>
        </table>
      </div>

      <div style="background: white; border-radius: 8px; border: 1px solid #ddd; padding: 15px;">
        <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; border-bottom: 1px solid #ddd; padding-bottom: 0.5rem;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙˆØ§Ù„Ù†Ø³Ø¨Ø©</h3>
        <table style="width: 100%; border-collapse: collapse;">
          <tr>
            <th style="border: 1px solid #ddd; padding: 8px; text-align: center; background-color: #f2f2f2; font-weight: bold;">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ</th>
            <td style="border: 1px solid #ddd; padding: 8px; text-align: center; font-weight: bold;">${currentResult.totalScore || '0'}</td>
          </tr>
          <tr>
            <th style="border: 1px solid #ddd; padding: 8px; text-align: center; background-color: #f2f2f2; font-weight: bold;">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ Ø§Ù„Ù…Ù…ÙƒÙ†</th>
            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${currentResult.totalOutOf || '0'}</td>
          </tr>
          <tr>
            <th style="border: 1px solid #ddd; padding: 8px; text-align: center; background-color: #f2f2f2; font-weight: bold;">Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©</th>
            <td style="border: 1px solid #ddd; padding: 8px; text-align: center; font-weight: bold; color: green;">${currentResult.percentage || '0'}%</td>
          </tr>
        </table>
      </div>
    `;
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†ØµØ± Ø¥Ù„Ù‰ Ø§Ù„Ø¬Ø³Ù… Ù…Ø¤Ù‚ØªØ§Ù‹
    document.getElementById('pdf-container').appendChild(printableElement);
    
    // Ø§Ø³ØªØ®Ø¯Ø§Ù… html2canvas Ù„Ø§Ù„ØªÙ‚Ø§Ø· Ù„Ù‚Ø·Ø© Ù„Ù„Ø¹Ù†ØµØ±
    const canvas = await html2canvas(printableElement, {
      scale: 2,
      useCORS: true,
      logging: false,
      backgroundColor: '#ffffff'
    });
    
    // ØªØ­ÙˆÙŠÙ„ Canvas Ø¥Ù„Ù‰ ØµÙˆØ±Ø©
    const imgData = canvas.toDataURL('image/jpeg', 0.98);
    
    // Ø¥Ù†Ø´Ø§Ø¡ PDF Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… jsPDF
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF('p', 'mm', 'a4');
    
    // Ø­Ø³Ø§Ø¨ Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„ØµÙˆØ±Ø© Ù„ØªÙ†Ø§Ø³Ø¨ PDF
    const pdfWidth = pdf.internal.pageSize.getWidth();
    const pdfHeight = pdf.internal.pageSize.getHeight();
    const imgWidth = canvas.width;
    const imgHeight = canvas.height;
    const ratio = Math.min(pdfWidth / imgWidth, pdfHeight / imgHeight);
    const imgX = (pdfWidth - imgWidth * ratio) / 2;
    const imgY = 10;
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ PDF
    pdf.addImage(imgData, 'JPEG', imgX, imgY, imgWidth * ratio, imgHeight * ratio);
    
    // Ø­ÙØ¸ PDF
    pdf.save(`Ù†ØªÙŠØ¬Ø©_${currentResult.name || 'Ø§Ù„Ø·Ø§Ù„Ø¨'}.pdf`);
    
    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù…Ø¤Ù‚Øª
    document.getElementById('pdf-container').removeChild(printableElement);
    
  } catch (error) {
    console.error('Error generating PDF:', error);
    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ PDF: ' + error.message);
  }
}

// ========== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© ==========
// ÙØªØ­/ØºÙ„Ù‚ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
function toggleChatbot() {
  const bot = document.getElementById('chatbot');
  bot.style.display = bot.style.display === 'flex' ? 'none' : 'flex';
  
  // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø¹Ù†Ø¯ ÙØªØ­Ù‡Ø§
  if (bot.style.display === 'flex') {
    resetChatbot();
  }
}

// Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
function resetChatbot() {
  document.getElementById('chatMessages').innerHTML = '';
  document.getElementById('chatOptions').style.display = 'none';
  document.getElementById('userDataForm').style.display = 'flex';
  document.getElementById('userName').value = '';
  document.getElementById('userPhone').value = '';
  document.getElementById('userEmail').value = '';
  userData = { name: '', phone: '', email: '' };
}

// Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø©
function addMessage(text, from = 'bot') {
  const container = document.getElementById('chatMessages');
  const msg = document.createElement('div');
  msg.style.marginBottom = '10px';
  msg.style.padding = '8px 12px';
  msg.style.borderRadius = '10px';
  msg.style.maxWidth = '85%';
  msg.style.wordBreak = 'break-word';
  if (from === 'bot') {
    msg.style.background = '#f0f9ff';
    msg.style.alignSelf = 'flex-start';
  } else {
    msg.style.background = '#3b82f6';
    msg.style.color = 'white';
    msg.style.alignSelf = 'flex-end';
  }
  msg.textContent = text;
  container.appendChild(msg);
  container.scrollTop = container.scrollHeight;
}

// Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
document.getElementById('submitUserData').addEventListener('click', function() {
  const name = document.getElementById('userName').value.trim();
  const phone = document.getElementById('userPhone').value.trim();
  const email = document.getElementById('userEmail').value.trim();
  
  if (!name || !phone || !email) {
    addMessage('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
    return;
  }
  
  // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
  userData = { name, phone, email };
  
  // Ø¥Ø®ÙØ§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
  document.getElementById('userDataForm').style.display = 'none';
  document.getElementById('chatOptions').style.display = 'flex';
  
  addMessage(`Ø´ÙƒØ±Ø§Ù‹ ${name}! ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒØŸ`);
});

// Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª
document.getElementById('chatOptions').addEventListener('click', async (e) => {
  const target = e.target;
  
  if (target.classList.contains('chatOption')) {
    const action = target.getAttribute('data-action');
    
    if (action === 'whatsapp') {
      addMessage(target.textContent, 'user');
      addMessage('Ø¬Ø§Ø±ÙŠ ØªØ­ÙˆÙŠÙ„Ùƒ Ø¥Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨...');
      window.open('https://wa.me/201274445091', '_blank');
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ†
      setTimeout(resetChatbot, 2000);
    } else if (action === 'ask') {
      addMessage(target.textContent, 'user');
      addMessage('Ù…Ù…ÙƒÙ† ØªÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§:');
      
      // Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø¨Ø­Ù‚Ù„ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø³Ø¤Ø§Ù„
      document.getElementById('chatOptions').innerHTML = `
        <input type="text" id="userQuestion" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ..." style="padding:8px; border-radius:8px; border:1px solid #ddd; width:100%;">
        <button id="sendQuestion" style="margin-top:5px; padding:8px; border-radius:8px; border:none; background:#3b82f6; color:white; cursor:pointer;">Ø¥Ø±Ø³Ø§Ù„</button>
      `;
      
      document.getElementById('sendQuestion').addEventListener('click', async () => {
        const question = document.getElementById('userQuestion').value.trim();
        if (question) {
          addMessage(question, 'user');
          addMessage('Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ø³ØªÙØ³Ø§Ø±Ùƒ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©...');
          
          try {
            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±
            const res = await fetch('/api/chat-inquiries', {
              method: 'POST',
              headers: {'Content-Type':'application/json'},
              body: JSON.stringify({ 
                message: question,
                userData: userData
              })
            });
            
            const data = await res.json();
            if(data.success){
              addMessage('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ø³ØªÙØ³Ø§Ø±Ùƒ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­! Ø³Ù†ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹.');
            } else {
              addMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.');
            }
          } catch(e){
            console.error(e);
            addMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.');
          }
          
          // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†Ù
          setTimeout(resetChatbot, 3000);
        }
      });
    }
  }
});
</script>
</body>
</html>
